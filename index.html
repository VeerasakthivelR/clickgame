<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bomb Exit Game üí£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<style>
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0;
    height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
    background: radial-gradient(circle at top, #222, #000);
    color: #fff;
}

/* Screens */
.screen {
    width: 100%;
    height: 100%;
    backdrop-filter: blur(6px);
    background: rgba(0,0,0,0.65);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    position: absolute;
    top: 0;
    left: 0;
}

.hidden { display: none; }

/* Buttons */
button {
    border: none;
    border-radius: 14px;
    padding: 14px 26px;
    margin: 10px;
    font-size: 16px;
    background: #34C759;
    color: #000;
}

/* Home */
.stats {
    font-size: 15px;
    opacity: 0.9;
    margin-bottom: 14px;
}

.toggle { font-size: 14px; margin-top: 6px; }

.watermark {
    font-size: 11px;
    opacity: 0.4;
    margin-top: 16px;
}

/* Game UI */
.topbar {
    font-size: 14px;
    margin-bottom: 10px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    width: 100%;
    max-width: 360px;
}

.game-btn {
    height: 52px;
    border-radius: 14px;
    background: rgba(255,255,255,0.15);
    color: #fff;
    font-size: 17px;
    transition: opacity .4s, transform .3s;
}

.fade {
    opacity: 0;
    pointer-events: none;
    transform: scale(.85);
}

/* Animations */
.pulse { animation: pulse .6s ease-out; }
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.12); box-shadow: 0 0 18px #34C759; }
    100% { transform: scale(1); }
}

.hint {
    box-shadow: 0 0 18px rgba(52,199,89,.9);
    border: 2px solid #34C759;
}

/* Bomb */
.flash { animation: flashRed .4s; }
@keyframes flashRed {
    0% { background: rgba(255,0,0,.85); }
    50% { background: rgba(255,0,0,.35); }
    100% { background: rgba(0,0,0,.65); }
}

.shake { animation: shake .4s; }
@keyframes shake {
    0%{transform:translate(0)}
    25%{transform:translate(-6px,4px)}
    50%{transform:translate(6px,-4px)}
    75%{transform:translate(-4px,-6px)}
    100%{transform:translate(0)}
}

.explosion {
    position: absolute;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255,60,60,.9);
    animation: explode .6s ease-out forwards;
}

@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(22); opacity: 0; }
}

/* FULLSCREEN LEVEL SCREEN */
.level-screen {
    font-size: 48px;
    font-weight: bold;
    animation: zoomIn .6s ease-out;
}

@keyframes zoomIn {
    0% { opacity: 0; transform: scale(.6); }
    100% { opacity: 1; transform: scale(1); }
}
</style>
</head>

<body>

<!-- HOME -->
<div class="screen" id="home">
    <h1>Bomb Exit Game üí£</h1>

    <div class="stats">
        Best Score: <span id="bestLevel">0</span> Levels Passed
    </div>

    <div class="toggle"><label><input type="checkbox" id="soundToggle"> üîä Sound</label></div>
    <div class="toggle"><label><input type="checkbox" id="vibrationToggle"> üéÆ Vibration</label></div>

    <button onclick="startGame()">START</button>
    <div class="watermark">Game Developed by Sakthii</div>
</div>

<!-- GAME -->
<div class="screen hidden" id="game">
    <div class="topbar">‚è±Ô∏è <span id="time">120</span>s | Level <span id="levelEl">1</span></div>
    <h2>Find the safe exit üëá</h2>
    <div class="grid" id="grid"></div>
</div>

<!-- LEVEL TRANSITION -->
<div class="screen hidden" id="levelScreen">
    <div class="level-screen" id="levelText"></div>
</div>

<!-- RESULT -->
<div class="screen hidden" id="result">
    <h1 id="resultText"></h1>
    <button onclick="resetGame()">üîÅ Play Again</button>
</div>

<!-- AUDIO -->
<audio id="bombSound" src="bomb.mp3"></audio>
<audio id="safeSound" src="safe.mp3"></audio>
<audio id="tickSound" src="tick.mp3" loop></audio>

<script>
const TOTAL_BTNS = 15;
const GAME_TIME = 120;

let level = 1, timeLeft = GAME_TIME;
let bombIndexes = [], safeIndex = -1;
let safeClicks = 0, transitioning = false, timer;

bestLevel.textContent = localStorage.getItem("bestLevel") || 0;

function play(a,v){ if(!soundToggle.checked) return; a.currentTime=0;a.volume=v;a.play().catch(()=>{}); }
function vibrate(p){ if(vibrationToggle.checked) navigator.vibrate?.(p); }

function startGame(){
    home.classList.add("hidden");
    game.classList.remove("hidden");
    level = 1;
    timeLeft = GAME_TIME;
    time.textContent = timeLeft;
    play(tickSound,.15);
    startTimer();
    loadLevel();
}

function startTimer(){
    clearInterval(timer);
    timer=setInterval(()=>{
        timeLeft--;
        time.textContent=timeLeft;
        if(timeLeft<=0) endGame("‚è±Ô∏è Time‚Äôs up!");
    },1000);
}

function loadLevel(){
    transitioning=false;
    safeClicks=0;
    levelEl.textContent=level;
    grid.innerHTML="";
    bombIndexes=[];

    while(bombIndexes.length<level){
        let r=Math.floor(Math.random()*TOTAL_BTNS);
        if(!bombIndexes.includes(r)) bombIndexes.push(r);
    }
    do{ safeIndex=Math.floor(Math.random()*TOTAL_BTNS); }
    while(bombIndexes.includes(safeIndex));

    for(let i=0;i<TOTAL_BTNS;i++){
        const b=document.createElement("button");
        b.className="game-btn";
        b.textContent="Click";
        b.onclick=()=>handleClick(i,b);
        grid.appendChild(b);
    }
}

function showLevelScreen(nextLevel){
    game.classList.add("hidden");
    levelScreen.classList.remove("hidden");
    levelText.textContent = "LEVEL " + nextLevel;

    setTimeout(()=>{
        levelScreen.classList.add("hidden");
        game.classList.remove("hidden");
        loadLevel();
    },2000);
}

function handleClick(i,btn){
    if(transitioning) return;

    if(i===safeIndex){
        transitioning=true;
        play(safeSound,.4);
        btn.classList.add("pulse");

        document.querySelectorAll(".game-btn").forEach(b=>{
            if(b!==btn) b.classList.add("fade");
        });

        setTimeout(()=>{
            level++;
            showLevelScreen(level);
        },600);
        return;
    }

    if(bombIndexes.includes(i)){
        transitioning=true;
        play(bombSound,.6);
        vibrate([200,100,200]);
        game.classList.add("flash","shake");

        const boom=document.createElement("div");
        boom.className="explosion";
        game.appendChild(boom);

        setTimeout(()=>{
            boom.remove();
            game.classList.remove("flash","shake");
            endGame("üí£ BOOM! You‚Äôre Out");
        },600);
        return;
    }

    safeClicks++;
    btn.innerHTML="‚ùå";
    btn.classList.add("fade");
    vibrate(30);

    if(safeClicks===3){
        document.querySelectorAll(".game-btn")[safeIndex]?.classList.add("hint");
    }
}

function endGame(text){
    clearInterval(timer);
    tickSound.pause();
    game.classList.add("hidden");
    result.classList.remove("hidden");
    resultText.textContent=text;

    const best=Math.max(level-1,Number(localStorage.getItem("bestLevel")||0));
    localStorage.setItem("bestLevel",best);
    bestLevel.textContent=best;
}

function resetGame(){
    result.classList.add("hidden");
    home.classList.remove("hidden");
}
</script>

</body>
</html>