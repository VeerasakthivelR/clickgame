<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Bomb Exit Game üí£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">

<style>
* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
}

body {
    margin: 0;
    height: 100vh;
    font-family: -apple-system, BlinkMacSystemFont, Arial, sans-serif;
    background: radial-gradient(circle at top, #222, #000);
    color: #fff;
}

.screen {
    width: 100%;
    height: 100%;
    backdrop-filter: blur(6px);
    background: rgba(0,0,0,0.65);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.hidden { display: none; }

button {
    border: none;
    border-radius: 14px;
    padding: 14px 26px;
    margin: 10px;
    font-size: 16px;
    background: #34C759;
    color: #000;
}

.toggle {
    font-size: 14px;
    margin-top: 6px;
}

.watermark {
    font-size: 11px;
    opacity: 0.4;
    margin-top: 16px;
}

.topbar {
    font-size: 14px;
    margin-bottom: 10px;
}

.grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
    width: 100%;
    max-width: 360px;
}

.game-btn {
    height: 52px;
    border-radius: 14px;
    background: rgba(255,255,255,0.15);
    color: #fff;
    font-size: 18px;
    transition: opacity 0.4s, transform 0.2s;
}

.fade {
    opacity: 0;
    pointer-events: none;
    transform: scale(0.9);
}

.pulse {
    animation: pulse 0.6s ease-out;
}

@keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 0 0 rgba(52,199,89,0.8); }
    50% { transform: scale(1.12); box-shadow: 0 0 18px rgba(52,199,89,1); }
    100% { transform: scale(1); box-shadow: 0 0 0 rgba(52,199,89,0); }
}

.hint {
    box-shadow: 0 0 16px rgba(52,199,89,0.9);
    border: 2px solid #34C759;
}

.flash {
    animation: flashRed 0.4s ease-in-out;
}

@keyframes flashRed {
    0%   { background: rgba(255,0,0,0.85); }
    50%  { background: rgba(255,0,0,0.35); }
    100% { background: rgba(0,0,0,0.65); }
}

.bombAnim {
    animation: shake 0.4s infinite;
}

@keyframes shake {
    0% { transform: translateX(0); }
    25% { transform: translateX(6px); }
    50% { transform: translateX(-6px); }
    75% { transform: translateX(6px); }
    100% { transform: translateX(0); }
}
</style>
</head>

<body>

<!-- HOME -->
<div class="screen" id="home">
    <h1>Are you ready to play?</h1>

    <div class="toggle">
        <label><input type="checkbox" id="soundToggle"> üîä Sound</label>
    </div>
    <div class="toggle">
        <label><input type="checkbox" id="vibrationToggle"> üéÆ Vibration</label>
    </div>

    <button onclick="startGame()">YES</button>
    <button onclick="missed()">NO</button>

    <div class="watermark">Game Developed by Sakthii</div>
</div>

<!-- GAME -->
<div class="screen hidden" id="game">
    <div class="topbar">
        ‚è±Ô∏è <span id="time">120</span>s | Level <span id="level">1</span>
    </div>
    <h2>Find the safe exit üëá</h2>
    <div class="grid" id="grid"></div>
</div>

<!-- RESULT -->
<div class="screen hidden" id="result">
    <h1 id="resultText"></h1>
    <button onclick="resetGame()">üîÅ Play Again</button>
</div>

<!-- AUDIO -->
<audio id="bombSound" src="bomb.mp3"></audio>
<audio id="safeSound" src="safe.mp3"></audio>
<audio id="tickSound" src="tick.mp3" loop></audio>

<script>
const TOTAL_BTNS = 15;
const GAME_TIME = 120;

let level = 1;
let timeLeft = GAME_TIME;
let timer;
let bombIndexes = [];
let safeIndex = -1;
let safeClicks = 0;
let levelTransition = false;

function vibrate(p) {
    if (vibrationToggle.checked) navigator.vibrate?.(p);
}

function play(a, v) {
    if (!soundToggle.checked) return;
    a.currentTime = 0;
    a.volume = v;
    a.play().catch(()=>{});
}

function missed() {
    alert("Ohh sorry, you missed the gameplay üòï");
}

function startGame() {
    home.classList.add("hidden");
    game.classList.remove("hidden");

    level = 1;
    timeLeft = GAME_TIME;
    time.textContent = timeLeft;

    play(tickSound, 0.15);
    startTimer();
    loadLevel();
}

function startTimer() {
    clearInterval(timer);
    timer = setInterval(() => {
        timeLeft--;
        time.textContent = timeLeft;
        if (timeLeft <= 0) endGame("‚è±Ô∏è Time‚Äôs up!");
    }, 1000);
}

function loadLevel() {
    levelTransition = false;
    safeClicks = 0;
    levelEl.textContent = level;
    grid.innerHTML = "";

    bombIndexes = [];
    while (bombIndexes.length < level) {
        let r = Math.floor(Math.random() * TOTAL_BTNS);
        if (!bombIndexes.includes(r)) bombIndexes.push(r);
    }

    do {
        safeIndex = Math.floor(Math.random() * TOTAL_BTNS);
    } while (bombIndexes.includes(safeIndex));

    for (let i = 0; i < TOTAL_BTNS; i++) {
        const b = document.createElement("button");
        b.className = "game-btn";
        b.textContent = "Click";
        b.onclick = () => handleClick(i, b);
        grid.appendChild(b);
    }
}

function handleClick(i, btn) {
    if (levelTransition) return;

    if (i === safeIndex) {
        levelTransition = true;
        play(safeSound, 0.4);
        vibrate(80);
        btn.classList.add("pulse");

        setTimeout(() => {
            level++;
            loadLevel();
        }, 500);
        return;
    }

    if (bombIndexes.includes(i)) {
        levelTransition = true;
        play(bombSound, 0.6);
        vibrate([250,120,250]);
        game.classList.add("flash");

        setTimeout(() => {
            game.classList.remove("flash");
            endGame("üí£ BOOM! You‚Äôre Out");
        }, 350);
        return;
    }

    safeClicks++;
    btn.innerHTML = "‚ùå<br><small>You are safe now,<br>find the safe exit<br>to pass this level</small>";
    btn.disabled = true;
    btn.style.fontSize = "12px";
    btn.style.lineHeight = "1.2";
    btn.classList.add("fade");
    vibrate(30);

    if (safeClicks === 3) {
        document.querySelectorAll(".game-btn")[safeIndex]?.classList.add("hint");
    }
}

function endGame(text) {
    clearInterval(timer);
    tickSound.pause();
    game.classList.add("hidden");
    result.classList.remove("hidden");
    result.classList.add("bombAnim");
    resultText.textContent = text;
}

function resetGame() {
    result.classList.remove("bombAnim");
    result.classList.add("hidden");
    home.classList.remove("hidden");
}

const time = document.getElementById("time");
const levelEl = document.getElementById("level");
</script>

</body>
</html>